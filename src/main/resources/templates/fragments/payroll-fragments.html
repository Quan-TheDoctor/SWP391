<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Payroll Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        secondary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
</head>
<div th:fragment="main-content" xmlns:sec="http://www.w3.org/1999/xhtml">
    <main class="flex-1 p-4">
        <div class="max-w-7xl mx-auto space-y-4">
            <!-- Header Section -->
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between p-4 bg-gradient-to-r from-primary-600 to-secondary-600 rounded-lg text-white shadow-lg animate__animated animate__fadeIn">
                <div>
                    <h1 class="text-2xl font-bold">Payroll Management</h1>
                    <p class="text-primary-100">Track and manage employee salary records</p>
                </div>

                <div class="flex gap-2">
                    <form th:action="@{/payroll/policies}" method="get">
                        <button type="submit"
                                class="px-4 py-2 bg-gray-100 text-primary-700 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-2 font-medium">
                            <i class="fas fa-cog"></i>
                            Setting
                        </button>
                    </form>
                    <button id="showReportBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2 font-medium">
                        <i class="fas fa-chart-pie"></i>
                        Reports
                    </button>
                    <button id="showAddPayrollBtn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center gap-2 font-medium">
                        <i class="fas fa-plus"></i>
                        Insert
                    </button>
                    <a th:href="@{/payroll/export/view}">
                        <button class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors flex items-center gap-2 font-medium">
                            <i class="fas fa-file-export"></i>
                            Export
                        </button>
                    </a>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-green-500">
                    <div class="flex items-center gap-3">
                        <div class="p-3 bg-green-100 rounded-full">
                            <i class="fas fa-money-bill-wave text-xl text-green-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Total Net Salary</p>
                            <p class="text-2xl font-bold text-green-700" th:text="${totalNetSalary != null ? T(java.lang.String).format('%,.0f', totalNetSalary) : '0'}">66,500,000</p>
                            <p class="text-xs text-gray-500">Current month</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-red-500">
                    <div class="flex items-center gap-3">
                        <div class="p-3 bg-red-100 rounded-full">
                            <i class="fas fa-clock text-xl text-red-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Total Unpaid Salary</p>
                            <p class="text-2xl font-bold text-red-700" th:text="${unpaidSalary != null ? T(java.lang.String).format('%,.0f', unpaidSalary) : '0'}">12,500,000</p>
                            <p class="text-xs text-gray-500">Pending payments</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-500">
                    <div class="flex items-center gap-3">
                        <div class="p-3 bg-blue-100 rounded-full">
                            <i class="fas fa-building text-xl text-blue-600"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Company Tax Contributions</p>
                            <p class="text-2xl font-bold text-blue-700" th:text="${companyTaxContributions != null ? T(java.lang.String).format('%,.0f', companyTaxContributions) : '0'}">0</p>
                            <p class="text-xs text-gray-500">Current month</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="text-lg font-semibold mb-3 text-gray-800 flex items-center">
                    <i class="fas fa-chart-line mr-2 text-primary-500"></i>
                    Monthly Salary Overview
                </h3>
                <div class="grid grid-cols-1 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h5 class="text-sm font-medium text-gray-700 mb-2">Monthly Salary Breakdown</h5>
                        <div id="monthlySalaryChart" class="h-64"></div>
                    </div>
                </div>
            </div>

            <!-- Search & Filter Section (Horizontal) -->
            <div class="bg-white rounded-lg shadow-md p-4 animate__animated animate__fadeIn">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-filter mr-2 text-primary-500"></i>
                        Search & Filter
                    </h3>

                    <!-- Search -->
                    <form id="searchForm" th:action="@{/payroll/search}" class="flex gap-2 w-full md:w-auto md:max-w-md">
                        <input type="text" name="query" placeholder="Search employee..."
                               class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                        <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>

                    <!-- Bulk Actions -->
                    <div class="flex gap-2">
                        <button id="bulkDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-trash-alt"></i>
                            <span>Delete</span>
                        </button>
                        <button id="bulkExportPdfBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-file-pdf"></i>
                            <span>Export PDF</span>
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <form id="multiFilterForm" th:action="@{/payroll/multi-filter}" method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Year</label>
                        <select name="year" id="yearFilter" onchange="submitMultiFilter()"
                                class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="all" th:selected="${param.year == null || param.year[0] == 'all'}">All Years</option>
                            <option value="2023" th:selected="${param.year != null && param.year[0] == '2023'}">2023</option>
                            <option value="2024" th:selected="${param.year != null && param.year[0] == '2024'}">2024</option>
                            <option value="2025" th:selected="${param.year != null && param.year[0] == '2025'}">2025</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Month</label>
                        <select name="month" id="monthFilter" onchange="submitMultiFilter()"
                                class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="all" th:selected="${param.month == null || param.month[0] == 'all'}">All Months</option>
                            <option value="1" th:selected="${param.month != null && param.month[0] == '1'}">January</option>
                            <option value="2" th:selected="${param.month != null && param.month[0] == '2'}">February</option>
                            <option value="3" th:selected="${param.month != null && param.month[0] == '3'}">March</option>
                            <option value="4" th:selected="${param.month != null && param.month[0] == '4'}">April</option>
                            <option value="5" th:selected="${param.month != null && param.month[0] == '5'}">May</option>
                            <option value="6" th:selected="${param.month != null && param.month[0] == '6'}">June</option>
                            <option value="7" th:selected="${param.month != null && param.month[0] == '7'}">July</option>
                            <option value="8" th:selected="${param.month != null && param.month[0] == '8'}">August</option>
                            <option value="9" th:selected="${param.month != null && param.month[0] == '9'}">September</option>
                            <option value="10" th:selected="${param.month != null && param.month[0] == '10'}">October</option>
                            <option value="11" th:selected="${param.month != null && param.month[0] == '11'}">November</option>
                            <option value="12" th:selected="${param.month != null && param.month[0] == '12'}">December</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Salary Range</label>
                        <select name="salaryRange" id="salaryRangeFilter" onchange="submitMultiFilter()"
                                class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="all" th:selected="${param.salaryRange == null || param.salaryRange[0] == 'all'}">All Ranges</option>
                            <option value="0,10000000" th:selected="${param.salaryRange != null && param.salaryRange[0] == '0,10000000'}">0 ~ 10,000,000</option>
                            <option value="10000000,20000000" th:selected="${param.salaryRange != null && param.salaryRange[0] == '10000000,20000000'}">10,000,000 ~ 20,000,000</option>
                            <option value="20000000,50000000" th:selected="${param.salaryRange != null && param.salaryRange[0] == '20000000,50000000'}">20,000,000 ~ 50,000,000</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
                        <select name="paymentStatus" id="paymentStatusFilter" onchange="submitMultiFilter()"
                                class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="all" th:selected="${param.paymentStatus == null || param.paymentStatus[0] == 'all'}">All Statuses</option>
                            <option value="Pending" th:selected="${param.paymentStatus != null && param.paymentStatus[0] == 'Pending'}">Pending</option>
                            <option value="Paid" th:selected="${param.paymentStatus != null && param.paymentStatus[0] == 'Paid'}">Paid</option>
                            <option value="Cancelled" th:selected="${param.paymentStatus != null && param.paymentStatus[0] == 'Cancelled'}">Cancelled</option>
                        </select>
                    </div>

                    <!-- Advanced filters (initially hidden) -->
                    <div id="advancedFilters" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                        <select name="department" id="departmentFilter" onchange="submitMultiFilter()"
                                class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="all" th:selected="${param.department == null || param.department[0] == 'all'}">All Departments</option>
                            <option value="HR" th:selected="${param.department != null && param.department[0] == 'HR'}">Human Resources</option>
                            <option value="IT" th:selected="${param.department != null && param.department[0] == 'IT'}">Information Technology</option>
                            <option value="Finance" th:selected="${param.department != null && param.department[0] == 'Finance'}">Finance</option>
                            <option value="Marketing" th:selected="${param.department != null && param.department[0] == 'Marketing'}">Marketing</option>
                        </select>
                    </div>

                    <div id="advancedFilters2" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                        <select name="position" id="positionFilter" onchange="submitMultiFilter()"
                                class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="all" th:selected="${param.position == null || param.position[0] == 'all'}">All Positions</option>
                            <option value="Manager" th:selected="${param.position != null && param.position[0] == 'Manager'}">Manager</option>
                            <option value="Developer" th:selected="${param.position != null && param.position[0] == 'Developer'}">Developer</option>
                            <option value="Analyst" th:selected="${param.position != null && param.position[0] == 'Analyst'}">Analyst</option>
                            <option value="Assistant" th:selected="${param.position != null && param.position[0] == 'Assistant'}">Assistant</option>
                        </select>
                    </div>

                    <div class="md:col-span-4 flex justify-end">
                        <button type="button" id="toggleAdvancedFilters" class="text-primary-600 hover:text-primary-800 text-sm font-medium flex items-center">
                            <i class="fas fa-plus-circle mr-1"></i> Show Advanced Filters
                        </button>
                    </div>
                </form>
            </div>

            <!-- Payroll Table -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col min-h-[390px] animate__animated animate__fadeIn">
                <div class="overflow-x-auto flex-1">
                    <form id="bulkActionForm" method="post">
                        <input type="hidden" name="selectedIds" id="selectedIdsInput" value="">
                        <table class="w-full min-w-[1024px]">
                            <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                    <input type="checkbox" id="selectAllCheckboxes" class="rounded border-gray-300 text-primary-500 focus:ring-primary-400">
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                    <a th:href="@{/payroll/sort(field='employee.firstName', direction = ${direction == 'asc' ? 'desc' : 'asc'})}"
                                       class="flex items-center gap-1 hover:text-primary-600 cursor-pointer">
                                        Employee
                                        <span class="ml-1">
                                            <i th:if="${direction == 'asc'}" class="fas fa-sort-up"></i>
                                            <i th:if="${direction == 'desc'}" class="fas fa-sort-down"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">
                                    <a th:href="@{/payroll/sort(field='baseSalary', direction = ${direction == 'asc' ? 'desc' : 'asc'})}"
                                       class="flex items-center justify-end gap-1 hover:text-primary-600 cursor-pointer">
                                        Base Salary
                                        <span class="ml-1">
                                            <i th:if="${sortField == 'baseSalary' && direction == 'asc'}" class="fas fa-sort-up"></i>
                                            <i th:if="${sortField == 'baseSalary' && direction == 'desc'}" class="fas fa-sort-down"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">
                                    <a th:href="@{/payroll/sort(field='netSalary', direction = ${direction == 'asc' ? 'desc' : 'asc'})}"
                                       class="flex items-center justify-end gap-1 hover:text-primary-600 cursor-pointer">
                                        Net Salary
                                        <span class="ml-1">
                                            <i th:if="${sortField == 'netSalary' && direction == 'asc'}" class="fas fa-sort-up"></i>
                                            <i th:if="${sortField == 'netSalary' && direction == 'desc'}" class="fas fa-sort-down"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">
                                    <a th:href="@{/payroll/sort(field='deductions,insuranceDeduction', direction = ${direction == 'asc' ? 'desc' : 'asc'})}"
                                       class="flex items-center justify-end gap-1 hover:text-primary-600 cursor-pointer">
                                        Total Deduction
                                        <span class="ml-1">
                                            <i th:if="${sortField == 'deductions,insuranceDeduction' && direction == 'asc'}" class="fas fa-sort-up"></i>
                                            <i th:if="${sortField == 'deductions,insuranceDeduction' && direction == 'desc'}" class="fas fa-sort-down"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">
                                    <a th:href="@{/payroll/sort(field='month,year', direction = ${direction == 'asc' ? 'desc' : 'asc'})}"
                                       class="flex items-center justify-center gap-1 hover:text-primary-600 cursor-pointer">
                                        Paid Date
                                        <span class="ml-1">
                                            <i th:if="${sortField == 'month,year' && direction == 'asc'}" class="fas fa-sort-up"></i>
                                            <i th:if="${sortField == 'month,year' && direction == 'desc'}" class="fas fa-sort-down"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">
                                    <a th:href="@{/payroll/sort(field='paymentStatus', direction = ${direction == 'asc' ? 'desc' : 'asc'})}"
                                       class="flex items-center justify-center gap-1 hover:text-primary-600 cursor-pointer">
                                        Status
                                        <span class="ml-1">
                                            <i th:if="${sortField == 'paymentStatus' && direction == 'asc'}" class="fas fa-sort-up"></i>
                                            <i th:if="${sortField == 'paymentStatus' && direction == 'desc'}" class="fas fa-sort-down"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50 transition-colors" th:each="p : ${payrolls}"
                                th:data-id="${p.getSalaryRecordId()}"
                                th:onclick="|window.location.href='/payroll/detail?salaryId=' + ${p.getSalaryRecordId()}|">

                                <td class="px-6 py-4" onclick="event.stopPropagation()">
                                    <input type="checkbox" name="subCheckboxes" th:value="${p.getSalaryRecordId()}" class="rounded border-gray-300 text-primary-500 focus:ring-primary-400">
                                </td>
                                <td class="px-6 py-4 font-medium">
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-primary-100 text-primary-600 rounded-full flex items-center justify-center font-bold">
                                            <span th:text="${#strings.substring(p.getEmployeeFirstName(), 0, 1)}"></span>
                                        </div>
                                        <span th:text="${T(java.lang.String).format('%s %s', p.getEmployeeFirstName(), p.getEmployeeLastName())}"></span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <span class="font-medium" th:text="${T(java.lang.String).format('%,.0f', p.getSalaryRecordBaseSalary())}"></span>
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <span class="font-medium text-primary-700" th:text="${T(java.lang.String).format('%,.0f', p.getSalaryRecordNetSalary())}"></span>
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <span class="text-red-600" th:text="${T(java.lang.String).format('%,.0f', (p.calculatedPersonalDeduction + p.calculatedPersonalDependentDeduction))}"></span>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <span class="px-2 py-1 bg-gray-100 rounded text-xs" th:text="${T(java.lang.String).format('%d/%d', p.getSalaryRecordMonth(), p.getSalaryRecordYear())}"></span>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <span th:if="${p.getSalaryRecordPaymentStatus() == 'Paid'}"
                                          class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
                                        <i class="fas fa-check-circle mr-1"></i> Paid
                                    </span>
                                    <span th:if="${p.getSalaryRecordPaymentStatus() == 'Pending'}"
                                          class="px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-clock mr-1"></i> Pending
                                    </span>
                                    <span th:if="${p.getSalaryRecordPaymentStatus() == 'Cancelled'}"
                                          class="px-2 py-1 rounded-full text-xs bg-red-100 text-red-800">
                                        <i class="fas fa-times-circle mr-1"></i> Cancelled
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-center" onclick="event.stopPropagation()">
                                    <div class="flex gap-2 justify-center">
                                        <a href="#" class="text-primary-600 hover:text-primary-800 transition-colors">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a th:href="@{/payroll/delete(salaryId=${p.salaryRecordId})}" class="text-red-600 hover:text-red-800 transition-colors">
                                            <i class="fas fa-trash-alt"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${payrolls.isEmpty()}" class="h-[200px]">
                                <td colspan="8" class="text-center text-gray-500 py-8">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                                        <p>No payroll records found</p>
                                        <p class="text-sm text-gray-400">Try adjusting your search or filter criteria</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                </div>

                <!-- Pagination -->
                <div th:replace="~{fragments/pagination :: pagination(${payrolls}, '/payroll', null, null)}"></div>
            </div>
        </div>
    </main>

    <!-- Bulk Delete Modal -->
    <div id="bulkDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-md animate__animated animate__fadeInDown">
            <h3 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                Confirm Deletion
            </h3>
            <p class="mb-6">Are you sure you want to delete the selected payroll records? This action cannot be undone.</p>
            <div class="flex justify-end gap-3">
                <button id="cancelBulkDelete" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    Cancel
                </button>
                <button id="confirmBulkDelete" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Add Payroll Modal -->
    <div id="addPayrollModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl animate__animated animate__fadeInDown">
            <h3 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fas fa-plus-circle text-primary-500 mr-2"></i>
                Add New Payroll Record
            </h3>

            <form id="addPayrollForm" method="post" action="/payroll/add">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Employee</label>
                        <select name="employeeId" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="">Select Employee</option>
                            <option value="1">Nguyen Van A</option>
                            <option value="2">Tran Thi B</option>
                            <option value="3">Le Van C</option>
                            <option value="4">Pham Thi D</option>
                            <option value="5">Hoang Van E</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Month/Year</label>
                        <div class="grid grid-cols-2 gap-2">
                            <select name="month" required class="p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3" selected>March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                            <select name="year" required class="p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                                <option value="2023">2023</option>
                                <option value="2024" selected>2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Base Salary</label>
                        <input type="number" name="baseSalary" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors" placeholder="Enter base salary" value="15000000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Total Allowance</label>
                        <input type="number" name="totalAllowance" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors" placeholder="Enter total allowance" value="2000000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Overtime Pay</label>
                        <input type="number" name="overtimePay" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors" placeholder="Enter overtime pay" value="0">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
                        <select name="paymentStatus" required class="w-full p-2 border rounded-md focus:ring-2 focus:ring-primary-300 transition-colors">
                            <option value="Pending" selected>Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Calculated Net Salary</label>
                        <div class="w-full p-2 border rounded-md bg-gray-50 font-medium text-primary-700" id="calculatedNetSalary">
                            15,300,000 VND
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Estimated Tax</label>
                        <div class="w-full p-2 border rounded-md bg-gray-50 font-medium text-red-600" id="calculatedTax">
                            1,700,000 VND
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancelAddPayroll" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                        Add Payroll Record
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl animate__animated animate__fadeInDown">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold flex items-center">
                    <i class="fas fa-chart-pie text-primary-500 mr-2"></i>
                    Payroll Reports
                </h3>
                <button id="closeReportsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h5 class="text-sm font-medium text-gray-700 mb-2">Monthly Salary Breakdown</h5>
                    <div id="monthlySalaryChart" class="h-64"></div>
                </div>
            </div>
            <div class="flex justify-between mt-4">
                <a href="/payroll" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center gap-2">
                    <i class="fas fa-list"></i>
                    Back to Payroll List
                </a>
                <a href="/payroll/export" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors flex items-center gap-2">
                    <i class="fas fa-download"></i>
                    Export Payroll Data
                </a>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            initializeMonthlySalaryChart();
            initializeFilters();
            initializeCheckboxes();
            initializeModals();
        });

        function initializeMonthlySalaryChart() {
            const chartData = /*[[${chartData}]]*/ { netSalary: {}, deductions: {} };
            const monthlySalaryChart = echarts.init(document.getElementById('monthlySalaryChart'));

            // Tạo mảng các tháng từ 1-12
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            // Chuyển đổi dữ liệu từ Map sang mảng cho biểu đồ
            const netSalaryData = [];
            const deductionsData = [];

            for (let i = 1; i <= 12; i++) {
                netSalaryData.push(chartData.netSalary[i] || 0);
                deductionsData.push(chartData.deductions[i] || 0);
            }

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let tooltip = params[0].axisValueLabel + '<br/>';
                        params.forEach(param => {
                            tooltip += `${param.marker} ${param.seriesName}: ${new Intl.NumberFormat('vi-VN').format(param.value)} VND<br/>`;
                        });
                        return tooltip;
                    }
                },
                legend: {
                    data: ['Net Salary', 'Deductions']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: months
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: function(value) {
                            return value >= 1000000 ? (value / 1000000).toFixed(1) + 'M' : value;
                        }
                    }
                },
                series: [
                    {
                        name: 'Net Salary',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        lineStyle: {
                            width: 3
                        },
                        itemStyle: {
                            color: '#8b5cf6'
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                {
                                    offset: 0,
                                    color: 'rgba(139, 92, 246, 0.3)'
                                },
                                {
                                    offset: 1,
                                    color: 'rgba(139, 92, 246, 0.1)'
                                }
                            ])
                        },
                        data: netSalaryData
                    },
                    {
                        name: 'Deductions',
                        type: 'line',
                        smooth: true,
                        symbol: 'diamond',
                        symbolSize: 8,
                        lineStyle: {
                            width: 3
                        },
                        itemStyle: {
                            color: '#10b981'
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                {
                                    offset: 0,
                                    color: 'rgba(16, 185, 129, 0.3)'
                                },
                                {
                                    offset: 1,
                                    color: 'rgba(16, 185, 129, 0.1)'
                                }
                            ])
                        },
                        data: deductionsData
                    }
                ]
            };

            monthlySalaryChart.setOption(option);
        }

        function initializeFilters() {
            const urlParams = new URLSearchParams(window.location.search);
            const hasAdvancedFilters = urlParams.has('department') || urlParams.has('position');

            if (hasAdvancedFilters) {
                const advancedFilters = document.getElementById('advancedFilters');
                const advancedFilters2 = document.getElementById('advancedFilters2');
                const toggleBtn = document.getElementById('toggleAdvancedFilters');

                if (advancedFilters && advancedFilters2 && toggleBtn) {
                    advancedFilters.style.display = 'block';
                    advancedFilters2.style.display = 'block';
                    toggleBtn.innerHTML = '<i class="fas fa-minus-circle mr-1"></i> Hide Advanced Filters';
                }
            }

            const toggleAdvancedFiltersBtn = document.getElementById('toggleAdvancedFilters');
            const advancedFilters = document.getElementById('advancedFilters');
            const advancedFilters2 = document.getElementById('advancedFilters2');

            if (toggleAdvancedFiltersBtn && advancedFilters && advancedFilters2) {
                toggleAdvancedFiltersBtn.addEventListener('click', function() {
                    const isHidden = advancedFilters.style.display === 'none';
                    advancedFilters.style.display = isHidden ? 'block' : 'none';
                    advancedFilters2.style.display = isHidden ? 'block' : 'none';

                    if (isHidden) {
                        this.innerHTML = '<i class="fas fa-minus-circle mr-1"></i> Hide Advanced Filters';
                    } else {
                        this.innerHTML = '<i class="fas fa-plus-circle mr-1"></i> Show Advanced Filters';
                    }
                });
            }
        }

        // Khởi tạo checkbox và các nút xử lý hàng loạt
        function initializeCheckboxes() {
            const selectAllCheckbox = document.getElementById('selectAllCheckboxes');
            const rowCheckboxes = document.querySelectorAll('input[name="subCheckboxes"]');
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            const bulkExportPdfBtn = document.getElementById('bulkExportPdfBtn');
            const selectedIdsInput = document.getElementById('selectedIdsInput');

            // Cập nhật trạng thái nút xử lý hàng loạt
            function updateBulkActionButtons() {
                const checkedBoxes = document.querySelectorAll('input[name="subCheckboxes"]:checked');
                const isAnyChecked = checkedBoxes.length > 0;

                if (bulkDeleteBtn) bulkDeleteBtn.disabled = !isAnyChecked;
                if (bulkExportPdfBtn) bulkExportPdfBtn.disabled = !isAnyChecked;
            }

            // Khởi tạo checkbox "Chọn tất cả"
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    rowCheckboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                    updateBulkActionButtons();
                });
            }

            // Thêm sự kiện cho từng checkbox
            rowCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Nếu có checkbox nào bị bỏ chọn, bỏ chọn checkbox "Chọn tất cả"
                    if (!this.checked && selectAllCheckbox) {
                        selectAllCheckbox.checked = false;
                    } else if (selectAllCheckbox) {
                        // Nếu tất cả checkbox đều được chọn, chọn checkbox "Chọn tất cả"
                        const allChecked = [...rowCheckboxes].every(cb => cb.checked);
                        selectAllCheckbox.checked = allChecked;
                    }
                    updateBulkActionButtons();
                });
            });

            // Lấy danh sách ID đã chọn
            function getSelectedIds() {
                const checkedBoxes = document.querySelectorAll('input[name="subCheckboxes"]:checked');
                return Array.from(checkedBoxes).map(cb => cb.value);
            }

            // Xử lý sự kiện cho nút xóa hàng loạt
            if (bulkDeleteBtn) {
                bulkDeleteBtn.addEventListener('click', function() {
                    const selectedIds = getSelectedIds();
                    if (selectedIds.length > 0) {
                        const bulkDeleteModal = document.getElementById('bulkDeleteModal');
                        if (bulkDeleteModal) bulkDeleteModal.classList.remove('hidden');
                    }
                });
            }

            // Xử lý sự kiện cho nút xuất PDF hàng loạt
            if (bulkExportPdfBtn) {
                bulkExportPdfBtn.addEventListener('click', function() {
                    const selectedIds = getSelectedIds();
                    if (selectedIds.length > 0) {
                        window.location.href = `/payroll/export-pdf?ids=${selectedIds.join(',')}`;
                    }
                });
            }

            // Xử lý sự kiện cho nút xác nhận xóa hàng loạt
            const confirmBulkDelete = document.getElementById('confirmBulkDelete');
            if (confirmBulkDelete) {
                confirmBulkDelete.addEventListener('click', function() {
                    const selectedIds = getSelectedIds();
                    if (selectedIds.length > 0 && selectedIdsInput) {
                        selectedIdsInput.value = selectedIds.join(',');
                        const form = document.getElementById('bulkActionForm');
                        if (form) {
                            form.action = '/payroll/bulk-delete';
                            form.submit();
                        }
                    }
                    const bulkDeleteModal = document.getElementById('bulkDeleteModal');
                    if (bulkDeleteModal) bulkDeleteModal.classList.add('hidden');
                });
            }

            // Xử lý sự kiện cho nút hủy xóa hàng loạt
            const cancelBulkDelete = document.getElementById('cancelBulkDelete');
            if (cancelBulkDelete) {
                cancelBulkDelete.addEventListener('click', function() {
                    const bulkDeleteModal = document.getElementById('bulkDeleteModal');
                    if (bulkDeleteModal) bulkDeleteModal.classList.add('hidden');
                });
            }
        }

        // Khởi tạo các modal
        function initializeModals() {
            // Modal thêm bảng lương
            const showAddPayrollBtn = document.getElementById('showAddPayrollBtn');
            const addPayrollModal = document.getElementById('addPayrollModal');
            const cancelAddPayroll = document.getElementById('cancelAddPayroll');
            const addPayrollForm = document.getElementById('addPayrollForm');

            if (showAddPayrollBtn && addPayrollModal) {
                showAddPayrollBtn.addEventListener('click', function() {
                    addPayrollModal.classList.remove('hidden');
                });
            }

            if (cancelAddPayroll && addPayrollModal) {
                cancelAddPayroll.addEventListener('click', function() {
                    addPayrollModal.classList.add('hidden');
                });
            }

            // Tự động tính toán lương ròng trong form
            if (addPayrollForm) {
                const baseSalaryInput = addPayrollForm.querySelector('input[name="baseSalary"]');
                const totalAllowanceInput = addPayrollForm.querySelector('input[name="totalAllowance"]');
                const overtimePayInput = addPayrollForm.querySelector('input[name="overtimePay"]');

                const updateCalculations = function() {
                    const baseSalary = parseFloat(baseSalaryInput.value) || 0;
                    const totalAllowance = parseFloat(totalAllowanceInput.value) || 0;
                    const overtimePay = parseFloat(overtimePayInput.value) || 0;

                    // Tính toán lương ròng
                    const grossSalary = baseSalary + totalAllowance + overtimePay;
                    const deductions = grossSalary * 0.105; // 10.5% cho bảo hiểm xã hội, y tế, v.v.
                    const taxableIncome = grossSalary - deductions - 11000000; // 11M là khoản giảm trừ cá nhân

                    let tax = 0;
                    if (taxableIncome > 0) {
                        if (taxableIncome <= 5000000) {
                            tax = taxableIncome * 0.05;
                        } else if (taxableIncome <= 10000000) {
                            tax = 5000000 * 0.05 + (taxableIncome - 5000000) * 0.1;
                        } else if (taxableIncome <= 18000000) {
                            tax = 5000000 * 0.05 + 5000000 * 0.1 + (taxableIncome - 10000000) * 0.15;
                        } else {
                            tax = 5000000 * 0.05 + 5000000 * 0.1 + 8000000 * 0.15 + (taxableIncome - 18000000) * 0.2;
                        }
                    }

                    const netSalary = grossSalary - deductions - tax;

                    // Cập nhật giá trị hiển thị
                    document.getElementById('calculatedNetSalary').textContent = new Intl.NumberFormat('vi-VN').format(netSalary) + ' VND';
                    document.getElementById('calculatedTax').textContent = new Intl.NumberFormat('vi-VN').format(tax) + ' VND';
                };

                // Thêm sự kiện cho các trường nhập liệu
                if (baseSalaryInput) baseSalaryInput.addEventListener('input', updateCalculations);
                if (totalAllowanceInput) totalAllowanceInput.addEventListener('input', updateCalculations);
                if (overtimePayInput) overtimePayInput.addEventListener('input', updateCalculations);

                // Tính toán ban đầu
                updateCalculations();
            }

            // Modal báo cáo
            const showReportBtn = document.getElementById('showReportBtn');
            const reportsModal = document.getElementById('reportsModal');
            const closeReportsModal = document.getElementById('closeReportsModal');

            if (showReportBtn && reportsModal) {
                showReportBtn.addEventListener('click', function() {
                    reportsModal.classList.remove('hidden');
                    setTimeout(() => {
                        initializeReportCharts();
                    }, 300);
                });
            }

            if (closeReportsModal && reportsModal) {
                closeReportsModal.addEventListener('click', function() {
                    reportsModal.classList.add('hidden');
                });
            }
        }

        // Hàm gửi form bộ lọc
        function submitMultiFilter() {
            document.getElementById('multiFilterForm').submit();
        }

        // Khởi tạo biểu đồ trong modal báo cáo
        function initializeReportCharts() {
            console.log("Initializing report charts");

            // Biểu đồ phân bố lương theo phòng ban
            const departmentChart = echarts.init(document.getElementById('departmentChart'));
            departmentChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    data: ['IT', 'HR', 'Finance', 'Marketing', 'Operations']
                },
                series: [
                    {
                        name: 'Department Distribution',
                        type: 'pie',
                        radius: '50%',
                        data: [
                            { value: 235000000, name: 'IT', itemStyle: { color: '#3b82f6' } },
                            { value: 124000000, name: 'HR', itemStyle: { color: '#10b981' } },
                            { value: 187000000, name: 'Finance', itemStyle: { color: '#f59e0b' } },
                            { value: 135000000, name: 'Marketing', itemStyle: { color: '#8b5cf6' } },
                            { value: 148000000, name: 'Operations', itemStyle: { color: '#ec4899' } }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            });

            // Biểu đồ trạng thái thanh toán
            const paymentStatusChart = echarts.init(document.getElementById('paymentStatusChart'));
            paymentStatusChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    data: ['Paid', 'Pending', 'Cancelled']
                },
                series: [
                    {
                        name: 'Payment Status',
                        type: 'pie',
                        radius: '50%',
                        data: [
                            { value: 735, name: 'Paid', itemStyle: { color: '#10b981' } },
                            { value: 210, name: 'Pending', itemStyle: { color: '#f59e0b' } },
                            { value: 35, name: 'Cancelled', itemStyle: { color: '#ef4444' } }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            });

            // Biểu đồ so sánh theo năm
            const yearComparisonChart = echarts.init(document.getElementById('yearComparisonChart'));
            yearComparisonChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    data: ['2023', '2024']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: function(value) {
                            return value >= 1000000 ? (value / 1000000).toFixed(1) + 'M' : value;
                        }
                    }
                },
                series: [
                    {
                        name: '2023',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        itemStyle: {
                            color: '#3b82f6'
                        },
                        data: [42000000, 45000000, 48000000, 46000000, 49000000, 51000000, 53000000, 55000000, 52000000, 56000000, 59000000, 62000000]
                    },
                    {
                        name: '2024',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        itemStyle: {
                            color: '#8b5cf6'
                        },
                        data: [45000000, 48000000, 52000000, 49000000, 51000000, 54000000, 56000000, 58000000, 55000000, 59000000, 62000000, 65000000]
                    }
                ]
            });

            // Biểu đồ phân tích đóng góp thuế của công ty theo tháng
            const companyTaxBreakdownChart = echarts.init(document.getElementById('companyTaxBreakdownChart'));
            companyTaxBreakdownChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let tooltip = params[0].axisValueLabel + '<br/>';
                        params.forEach(param => {
                            tooltip += `${param.marker} ${param.seriesName}: ${new Intl.NumberFormat('vi-VN').format(param.value)} VND<br/>`;
                        });
                        return tooltip;
                    }
                },
                legend: {
                    data: ['Company Tax Contributions']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: function(value) {
                            return value >= 1000000 ? (value / 1000000).toFixed(1) + 'M' : value;
                        }
                    }
                },
                series: [
                    {
                        name: 'Company Tax Contributions',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        itemStyle: {
                            color: '#3b82f6'
                        },
                        data: [2178000, 2323200, 2516800, 2371600, 2468400, 2613600, 2710400, 2807200, 2662000, 2855600, 3000800, 3146000]
                    }
                ]
            });

            // Biểu đồ loại đóng góp thuế của công ty
            const contributionTypesChart = echarts.init(document.getElementById('contributionTypesChart'));
            contributionTypesChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} VND ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    data: ['Health Insurance', 'Social Insurance', 'Union Fee', 'Unemployment Insurance']
                },
                series: [
                    {
                        name: 'Contribution Types',
                        type: 'pie',
                        radius: '50%',
                        data: [
                            { value: 9500000, name: 'Health Insurance', itemStyle: { color: '#10b981' } },
                            { value: 16800000, name: 'Social Insurance', itemStyle: { color: '#3b82f6' } },
                            { value: 2300000, name: 'Union Fee', itemStyle: { color: '#8b5cf6' } },
                            { value: 3400000, name: 'Unemployment Insurance', itemStyle: { color: '#f59e0b' } }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            });

            // Đảm bảo biểu đồ thay đổi kích thước khi cửa sổ thay đổi kích thước
            window.addEventListener('resize', function() {
                departmentChart.resize();
                paymentStatusChart.resize();
                yearComparisonChart.resize();
                companyTaxBreakdownChart.resize();
                contributionTypesChart.resize();
            });
        }

        // Cập nhật biểu đồ trong modal báo cáo
        function updateReportCharts(data) {
            // Cập nhật biểu đồ phân tích hàng tháng
            const companyTaxBreakdownChart = echarts.getInstanceByDom(document.getElementById('companyTaxBreakdownChart'));
            if (companyTaxBreakdownChart && data.monthlyContributions) {
                const monthlyData = [];
                for (let i = 1; i <= 12; i++) {
                    monthlyData.push(data.monthlyContributions[i] || 0);
                }
                companyTaxBreakdownChart.setOption({
                    series: [{
                        data: monthlyData
                    }]
                });
            }

            // Cập nhật biểu đồ loại đóng góp
            const contributionTypesChart = echarts.getInstanceByDom(document.getElementById('contributionTypesChart'));
            if (contributionTypesChart) {
                contributionTypesChart.setOption({
                    series: [{
                        data: [
                            { value: data.healthInsurance || 0, name: 'Health Insurance', itemStyle: { color: '#10b981' } },
                            { value: data.socialInsurance || 0, name: 'Social Insurance', itemStyle: { color: '#3b82f6' } },
                            { value: data.unionFee || 0, name: 'Union Fee', itemStyle: { color: '#8b5cf6' } },
                            { value: data.unemploymentInsurance || 0, name: 'Unemployment Insurance', itemStyle: { color: '#f59e0b' } }
                        ]
                    }]
                });
            }
        }
    </script>
</div>
</html>
