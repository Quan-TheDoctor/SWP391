<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đơn Xin Nghỉ Phép | HR System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
<div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
    <!-- Header -->
    <div class="bg-blue-600 p-6 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold"><i class="fas fa-file-signature mr-3"></i>Đơn Xin Nghỉ Phép</h1>
                <p class="mt-1 opacity-90">Vui lòng điền đầy đủ thông tin bên dưới</p>
            </div>
            <div class="bg-white text-blue-600 p-2 rounded-lg hidden md:block">
                <i class="fas fa-calendar-alt text-3xl"></i>
            </div>
        </div>
    </div>

    <!-- Form Content -->
    <div class="p-6 md:p-8">
        <form th:action="@{/leave/create-leave(department=${leaveRequest.departmentId}, position=${leaveRequest.position}, employee=${leaveRequest.employee != null ? leaveRequest.employee.employeeId : ''}, leaveType=${leaveRequest.leaveType}, startDate=${leaveRequest.startDate}, endDate=${leaveRequest.endDate}, reason=${leaveRequest.reason})}"
              method="GET" class="space-y-6">

            <!-- Department -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="department" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-building mr-2 text-blue-500"></i>Phòng Ban
                    </label>
                    <select id="department" name="department" onchange="this.form.submit();"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">-- Chọn Phòng Ban --</option>
                        <option th:each="dept : ${departmentList}"
                                th:value="${dept.departmentId}"
                                th:text="${dept.departmentName}"
                                th:selected="${leaveRequest.departmentId == dept.departmentId}">
                        </option>
                    </select>
                </div>

                <!-- Position -->
                <div>
                    <label for="position" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-user-tie mr-2 text-blue-500"></i>Vị Trí
                    </label>
                    <select id="position" name="position" onchange="this.form.submit();"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">-- Chọn Vị Trí --</option>
                        <option th:each="pos : ${positionList}"
                                th:value="${pos.positionName}"
                                th:text="${pos.positionName}"
                                th:selected="${leaveRequest.position == pos.positionName}">
                        </option>
                    </select>
                </div>
            </div>

            <!-- Employee -->
            <div>
                <label for="employee" class="block text-sm font-medium text-gray-700 mb-1">
                    <i class="fas fa-user mr-2 text-blue-500"></i>Nhân Viên
                </label>
                <select id="employee" name="employee" onchange="this.form.submit();"
                        class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">-- Chọn Nhân Viên --</option>
                    <option th:each="empl : ${employeeList}"
                            th:value="${empl.employeeId}"
                            th:text="${empl.firstName + ' ' + empl.lastName}"
                            th:selected="${leaveRequest.employee != null and leaveRequest.employee.employeeId == empl.employeeId}">
                    </option>
                </select>
            </div>

            <!-- Leave Type -->
            <div>
                <label for="leaveType" class="block text-sm font-medium text-gray-700 mb-1">
                    <i class="fas fa-umbrella-beach mr-2 text-blue-500"></i>Loại Nghỉ Phép
                </label>
                <select id="leaveType" name="leaveType" onchange="this.form.submit();"
                        class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">-- Chọn Loại Nghỉ Phép --</option>
                    <option th:each="leave : ${leavePolicies}"
                            th:value="${leave.leavePolicyName}"
                            th:text="${leave.leavePolicyName}"
                            th:selected="${leaveRequest.leaveType == leave.leavePolicyName}">
                    </option>
                </select>
            </div>

            <!-- Date Range -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-calendar-day mr-2 text-blue-500"></i>Ngày Bắt Đầu
                    </label>
                    <input type="date" id="start-date" name="startDate"
                           th:value="${leaveRequest.startDate}" onchange="this.form.submit();"
                           class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                </div>

                <div>
                    <label for="end-date" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-calendar-day mr-2 text-blue-500"></i>Ngày Kết Thúc
                    </label>
                    <input type="date" id="end-date" name="endDate"
                           th:value="${leaveRequest.endDate}" onchange="this.form.submit();"
                           class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                </div>
            </div>

            <!-- Reason -->
            <div>
                <label for="reason" class="block text-sm font-medium text-gray-700 mb-1">
                    <i class="fas fa-comment-dots mr-2 text-blue-500"></i>Lý Do Nghỉ
                </label>
                <textarea id="reason" name="reason" rows="3" onchange="this.form.submit();"
                          class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                          placeholder="Nhập lý do nghỉ phép chi tiết..." th:text="${leaveRequest.reason}"></textarea>
            </div>

            <!-- Total Days -->
            <div class="bg-blue-50 p-4 rounded-lg">
                <label for="total-days" class="block text-sm font-medium text-gray-700 mb-1">
                    <i class="fas fa-calculator mr-2 text-blue-500"></i>Tổng Số Ngày Nghỉ
                </label>
                <input type="text" id="total-days" name="totalDays" th:value="${leaveRequest.totalDays}" readonly
                       class="mt-1 block w-full pl-3 pr-10 py-2 text-lg font-bold text-blue-600 border-0 bg-blue-50 focus:outline-none focus:ring-0 sm:text-sm">
            </div>
        </form>

        <!-- Submit Button -->
        <form th:action="@{/leave/submit-leave}" method="POST" class="mt-8">
            <input type="hidden" name="employeeId" th:value="${leaveRequest.employee}">
            <input type="hidden" name="leaveType" th:value="${leaveRequest.leaveType}">
            <input type="hidden" name="startDate" th:value="${leaveRequest.startDate}">
            <input type="hidden" name="endDate" th:value="${leaveRequest.endDate}">
            <input type="hidden" name="totalDays" th:value="${leaveRequest.totalDays}">
            <input type="hidden" name="reason" th:value="${leaveRequest.reason}">

            <button type="submit"
                    class="w-full md:w-auto px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                <i class="fas fa-paper-plane mr-2"></i>Send Leave Permit
            </button>
        </form>
    </div>

    <!-- Footer -->
    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
        <p class="text-sm text-gray-500 text-center">
            <i class="fas fa-info-circle mr-1"></i> Vui lòng kiểm tra kỹ thông tin trước khi gửi đơn
        </p>
    </div>
</div>

<script>
    const leaveType = document.getElementById('leaveType');
    const leaveTypeHidden = document.getElementById('leaveTypeHidden');

    leaveType.addEventListener('change', function () {
        leaveTypeHidden.value = this.value;
        document.getElementById('leaveTypeForm').submit();
    });

    startDate.addEventListener('change', calculateLeaveDays);
    endDate.addEventListener('change', calculateLeaveDays);
</script>
</body>
</html>